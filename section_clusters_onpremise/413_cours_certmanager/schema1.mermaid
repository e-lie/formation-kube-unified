flowchart TB
    subgraph user["ğŸ‘¤ Utilisateur"]
        create[CrÃ©e une ressource<br/>Certificate]
    end
    
    subgraph k8s["ğŸ¯ Cluster Kubernetes"]
        subgraph crds["ğŸ“‹ Custom Resources"]
            cert[Certificate<br/>example.com]
            certreq[CertificateRequest<br/>contient le CSR]
            issuer[Issuer/ClusterIssuer<br/>letsencrypt-prod]
            order[Order<br/>commande ACME]
            challenge[Challenge<br/>validation HTTP/DNS]
        end
        
        subgraph controllers["âš™ï¸ cert-manager Controllers"]
            certctrl[Certificate Controller]
            issuerctrl[Issuer Controller]
            challengectrl[Challenge Controller]
            orderctrl[Order Controller]
        end
        
        subgraph k8sres["ğŸ“¦ Ressources K8s"]
            secret[Secret<br/>example-com-tls<br/>contient cert + key]
            ingress[Ingress<br/>utilise le Secret]
            svc[Service]
            pod[Pods]
        end
    end
    
    subgraph external["ğŸŒ SystÃ¨mes Externes"]
        ca[AutoritÃ© de Certification<br/>Let's Encrypt/Vault/AWS PCA]
    end
    
    subgraph validation["âœ… Validation"]
        http01[Challenge HTTP-01<br/>Fichier web temporaire]
        dns01[Challenge DNS-01<br/>Enregistrement TXT]
    end
    
    create --> cert
    cert -.1 Observe.-> certctrl
    certctrl -.2 GÃ©nÃ¨re clÃ© privÃ©e.-> certctrl
    certctrl -.3 CrÃ©e.-> certreq
    certreq -.4 RÃ©fÃ©rence.-> issuer
    certctrl -.5 Observe.-> issuerctrl
    
    issuerctrl -.6 Type ACME.-> orderctrl
    orderctrl -.7 CrÃ©e.-> order
    order -.8 NÃ©cessite validation.-> challengectrl
    challengectrl -.9 CrÃ©e.-> challenge
    
    challenge -.10a HTTP-01.-> http01
    challenge -.10b DNS-01.-> dns01
    
    http01 -.11a Expose via.-> ingress
    dns01 -.11b CrÃ©e TXT.-> external
    
    challengectrl -.12 Validation OK.-> orderctrl
    orderctrl -.13 Soumet CSR.-> ca
    ca -.14 Retourne certificat signÃ©.-> issuerctrl
    issuerctrl -.15 Met Ã  jour.-> certreq
    certctrl -.16 Stocke cert+key.-> secret
    
    secret --> ingress
    ingress --> svc
    svc --> pod
    
    certctrl -.Surveille expiration et renouvelle.-> cert
    
    style cert fill:#326CE5,color:#fff
    style certreq fill:#326CE5,color:#fff
    style issuer fill:#326CE5,color:#fff
    style order fill:#FFB84D,color:#000
    style challenge fill:#FFB84D,color:#000
    style secret fill:#4CAF50,color:#fff
    style ca fill:#9C27B0,color:#fff
    style certctrl fill:#FF6B6B,color:#fff
    style issuerctrl fill:#FF6B6B,color:#fff
    style challengectrl fill:#FF6B6B,color:#fff
    style orderctrl fill:#FF6B6B,color:#fff